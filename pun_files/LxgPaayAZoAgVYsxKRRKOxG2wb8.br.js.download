var GlobalActionMenu;(function(n){function tt(n){var i=n.querySelector(".actionmenuexp"),r=n.querySelector("."+o),t=n.querySelector(".actionmenucontent"),u=n.querySelector("."+v);t&&(ut(u,i,r,t,n),rt(u,i,r,t,n))}function t(n,t,i,e,o,s){var g,y,p,v,b,h;if(!Lib.CssClass.contains(e,f)){ft(n,t,i);var k=Lib.CssClass.contains(e,u),d=Lib.CssClass.contains(e,r),nt=!k&&!d;for(Lib.CssClass.add(e,f),Lib.CssClass.add(e,a),Lib.CssClass.remove(e,r),Lib.CssClass.remove(o,l),Lib.CssClass.remove(e,u),g=o.firstElementChild,y=g.getElementsByTagName("a"),h=0;h<y.length;h++)y[h].setAttribute("aria-expanded","false");if(sb_st(function(){return sj_evt.fire("GlobalActionMenu:Closed")},1e3),p=function(n){s?s.focus():n&&n.focus()},k||w(!1,e),d){if(v=c(),b=!1,v)for(h=0;h<v.length;h++)v[h].parentElement==i.parentElement&&(v[h].focus(),b=!0);b||p(i)}nt&&p(t)}}function it(n,t){var i=Lib.CssClass.contains(n,u);Lib.CssClass.add(t,l);Lib.CssClass.remove(n,a);Lib.CssClass.remove(n,f);sb_st(function(){return sj_evt.fire("GlobalActionMenu:Opened")},1e3);i||w(!0,n)}function rt(n,i,r,f,e){var c,o,h;if(sj_evt.bind(s,function(){return t(n,i,r,f,e)}),c=function(){return sj_evt.fire(s)},sj_be(_d,"touchstart",c),sj_be(_d,"mousedown",c),sj_be(f,"touchstart",function(n){return n.stopPropagation()}),sj_be(f,"mousedown",function(n){return n.stopPropagation()}),Lib.CssClass.contains(f,u)||sj_be(f,"click",function(){return t(n,i,r,f,e)}),sj_be(f,"touchmove",function(){return t(n,i,r,f,e)}),sj_be(_d,"focus",function(u){var o;i&&i.contains(u.target)&&(o=i);r&&r.contains(u.target)&&(o=r);f.contains(u.target)||t(n,i,r,f,e,o)},!0),AccessibilityHelpers.activateButtonByKey(f,[13,32],function(){return t(n,i,r,f,e)}),e&&(o=e.querySelectorAll("a"),o))for(h=0;h<o.length;h++)sj_be(o[h],"keydown",function(u){u.keyCode==27&&t(n,i,r,f,e)});i&&(sj_be(i,"touchstart",function(n){return n.stopPropagation()}),sj_be(i,"mousedown",function(n){return n.stopPropagation()}),sj_be(i,"touchmove",function(){return t(n,i,r,f,e)}),sj_be(i,"keydown",function(u){u.keyCode==27&&t(n,i,r,f,e)}));r&&(sj_be(r,"touchstart",function(n){return n.stopPropagation()}),sj_be(r,"mousedown",function(n){return n.stopPropagation()}),sj_be(r,"touchmove",function(){return t(n,i,r,f,e)}),sj_be(r,"keydown",function(u){u.keyCode==27&&t(n,i,r,f,e)}));n&&(sj_be(n,"touchstart",function(n){return n.stopPropagation()}),sj_be(n,"mousedown",function(n){return n.stopPropagation()}),sj_be(n,"touchmove",function(){return t(n,i,r,f,e)}),sj_be(n,"keydown",function(u){u.keyCode==27&&t(n,i,r,f,e)}))}function ut(n,t,h,l,a){var b=l.offsetWidth,w,p;Lib.CssClass.add(l,r);w=l.offsetWidth;Lib.CssClass.remove(l,r);p=function(h){h.setAttribute("aria-expanded","true");var tt=function(n,t){n?(Lib.CssClass.add(l,r),y(a,h,l,w)):t?Lib.CssClass.add(l,u):y(a,h,l,b);it(l,a)},p=Lib.CssClass.contains(h,o),nt=Lib.CssClass.contains(h,v),k=Lib.CssClass.contains(l,f),rt=!k&&Lib.CssClass.contains(l,r),ut=!k&&Lib.CssClass.contains(l,u),ft=k||rt!=p||ut!=nt,d=c();sj_evt.fire(s);ft?(p?(i(n,-1),i(t,-1),e(d,-1)):(i(n,0),i(t,0),e(d,0)),sb_st(function(){return tt(p,nt)},g)):(i(n,0),i(t,0),e(d,0))};t&&(sj_be(t,"click",function(){return p(t)}),AccessibilityHelpers.activateButtonByKey(t,[13,32],function(){return p(t)}));h&&(sj_be(h,"click",function(){return p(h)}),AccessibilityHelpers.activateButtonByKey(h,[13,32],function(){return p(h)}));n&&(sj_be(n,"click",function(){return p(n)}),AccessibilityHelpers.activateButtonByKey(n,[13,32],function(){return p(n)}))}function ft(n,t,r){e(c(),0);i(n,0);i(t,0);i(r,0)}function i(n,t){n&&(n.tabIndex=t)}function e(n,t){if(n)for(var r=0;r<n.length;r++)i(n[r],t)}function y(n,t,i,r){if(t&&i){var c=t.getBoundingClientRect(),f=c.left,e=_w.innerWidth-f-t.offsetWidth,o=c.top,l=_w.innerHeight-o-t.offsetHeight;i.style.position="fixed";f>e?f+t.offsetWidth<r?(i.style.left="0",i.style.right=""):(i.style.left="",i.style.right=e+"px"):e+t.offsetWidth<r?(i.style.left="",i.style.right="0"):(i.style.left=f+"px",i.style.right="");o>l?(i.style.top="",i.style.bottom=l+t.offsetHeight+"px"):(i.style.bottom="",i.style.top=o+t.offsetHeight+"px");var a=n.getBoundingClientRect(),u=i.getBoundingClientRect(),s=u.left-a.left,h=u.top-a.top,v=u.top,y=u.left;i.style.right="";i.style.bottom="";i.style.left=s+"px";i.style.top=h+"px";i.style.position="absolute";u=i.getBoundingClientRect();s+=y-u.left;h+=v-u.top;i.style.top=h+"px";i.style.left=s+"px"}}function p(n,t){var r=n.querySelectorAll(t),i,u,f;if(r)for(i=0;i<r.length;i++)u=r[i],f=u.getAttribute("data-medium"),Sharing.logEvent(f,Sharing.ShareStage.Visible,"GlobalAction sharing",n)}function w(n,t){_w.Log2?Log2.LogEvent("ClientInst",{FID:"GlobalAction.Expansion",AppNS:b(t),K:k(t),Category:"CommonControls"},n?"Open":"Close",null,null,null,null,null):Log.Log(n?"Open":"Close","GlobalAction.Expansion","ClientInst",!1,"AppNS",b(t),"K",k(t),"Category","CommonControls");n&&p(t,"[data-type='shareMedium']")}function h(){var r=_d.querySelectorAll(n.globalActionMenuSelector),u,i,t;if(r)for(u="data-initialized",i=0;i<r.length;i++)(t=r[i],t.getAttribute(u)!=="1")&&(tt(t),p(t,".topactions [data-type='shareMedium']"),t.setAttribute(u,"1"))}function c(){return typeof PrintAction!="undefined"?PrintAction.getPrintActions():null}function et(){h();typeof ShareAction!="undefined"&&ShareAction.initShareActions();typeof PrintAction!="undefined"&&PrintAction.initPrintActions();typeof FeedbackAction!="undefined"&&FeedbackAction.initFeedbackActions();typeof CustomAction!="undefined"&&CustomAction.initCustomActions()}function ot(n,t){var i=n&&_qs("."+o,n);st(i,t)}function st(t,i){t&&(n.promoteActionImpl?n.promoteActionImpl(t,i):ht(function(){n.promoteActionImpl&&n.promoteActionImpl(t,i)}))}function ht(n){var t=nt+"?IG="+_G.IG,i={callback:function(t,i){t&&(i.appendTo(sj_b),n())}};sj_ajax(t,i)}function b(n){return d(n,"appns")}function k(n){return d(n,"k")}function d(n,t,i){if(i===void 0&&(i=null),!n)return null;var r="data-"+t;return i===null?n.getAttribute(r):(n.setAttribute(r,i),i)}var l="openmenu",f="hiddenmenu",a="nonemenu",r="sharemenu",o="shareactionexp",s="menuDismiss",v="cortanaactionexp",u="cortanamenu",g=200,nt="/shared/gamp/";n.globalActionMenuSelector=".actionmenu";n.bindGlobalActionMenuEvents=et;n.promoteShareAction=ot;sj_be(_w,"load",function(){return h()});sj_evt.bind("ajax.load",function(){return h()})})(GlobalActionMenu||(GlobalActionMenu={}))